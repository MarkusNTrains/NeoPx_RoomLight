<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MoBa Room Light</title>
	<!--<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>-->
<!--	<script src="jquery-1.12.4.js"></script>
	<script src="jquery-ui.js"></script> -->
	<script type="text/javascript" charset="utf-8">
		const LightScene = 
		{
			OFFICE_TABLE_WW: 0,
			LIGHT_ON_WW: 1,
			DISCO: 2,
			SUNSET: 3,
			SUNRISE: 4,
			POWER_OFF: 5,
			IDLE: 6
		};
		
		
		var xml_request = "";
		var s_lock_send_data = false;
		var s_is_send_data_pending = false;

		function ReleaseLock()
		{
			s_lock_send_data = false;
			if (s_is_send_data_pending == true)
			{
				SendDataToArduino();
			}
		}
		
		function SendDataToArduino()
		{
			if (s_lock_send_data == false)
			{
				s_lock_send_data = true;

				nocache = "&nocache=" + Math.random() * 1000000;
				var request = new XMLHttpRequest();
				request.onreadystatechange = function()
				{
					if (this.readyState == 4) 
					{
						if (this.status == 200) 
						{
							if (this.responseXML != null) 
							{
								// XML file received - contains LED states
								var re;
								var num_LEDs;
								var i;
								var ledstr = "";
								
								/*re = this.responseXML.getElementsByTagName('LED');
								num_LEDs = re.length;
								
								for (i = 0; i < num_LEDs; i++) 
								{
									ledstr = "LED" + (i + 1);
									if (re[i].childNodes[0].nodeValue === "checked") 
									{
										document.getElementsByName(ledstr)[0].checked = true;
									}
									else 
									{
										document.getElementsByName(ledstr)[0].checked = false;
									}
								}*/



								//re = this.responseXML.getElementsByTagName('scene');
								
								
								re = this.responseXML.getElementsByTagName('brightness');
								document.getElementById("brightness_slider").value = re[0].childNodes[0].nodeValue;
								document.getElementById("brightness_value").innerHTML = re[0].childNodes[0].nodeValue;

							}
						}
					}
				}
				// send HTTP GET request with LEDs to switch on/off if any
				request.open("GET", "ajax_inputs" + xml_request + nocache, true);
				request.send(null);
				xml_request = "";
				s_is_send_data_pending = false;
				
				// lock Send to Arduino
				setTimeout('ReleaseLock()', 200);
			}
			else
			{
				s_is_send_data_pending = true;
			}
		}
		
		// service LEDs when checkbox checked/unchecked
		/*function GetCheck(led_num_str, cb)
		{
			if (cb.checked) {
				strLED += ("&" + led_num_str + "=1");
			}
			else {
				strLED += ("&" + led_num_str + "=0");
			}
		}*/
		
		function LightSceneButtonPushed(scene, bt)
		{
			var matches = document.getElementsByClassName('active-class');

			for (var cnt = 0; cnt < matches.length; cnt++) 
			{
				matches[cnt].classList.remove('active-class');
			}
			
			bt.classList.add("active-class");
			
			xml_request = "&LightScene=" + scene;
			SendDataToArduino();
		}
		
		function BrighntessSliderChanged()
		{
			var slider = document.getElementById("brightness_slider");
			var output = document.getElementById("brightness_value");
			output.innerHTML = slider.value;

			/*slider.oninput = function() 
			{
				output.innerHTML = slider.value;
			}*/

			xml_request = "&SetBrightness=" + slider.value;
			SendDataToArduino();
		}

		// 2 thumb slider
		"use strict";
		addEventListener('input', e => {
            if (e.target.classList.contains("twoThumbSlider"))
            {
                let _t = e.target;

                _t.parentNode.style.setProperty(`--${_t.id}`, +_t.value);
                
                SliderTwoThumb_Update();
            }
		}, false);

		function SliderTwoThumb_Update()
		{
            var xs = parseInt(getComputedStyle(document.getElementById("slider_columen")).getPropertyValue('--a'), 10);
            var xe = parseInt(getComputedStyle(document.getElementById("slider_columen")).getPropertyValue('--b'), 10);
            var ys = parseInt(getComputedStyle(document.getElementById("slider_row")).getPropertyValue('--a'), 10);
            var ye = parseInt(getComputedStyle(document.getElementById("slider_row")).getPropertyValue('--b'), 10);

            if (xs > xe)
            {
                var tmp = xs;
                xs = xe;
                xe = tmp;
            }
            if (ys > ye)
            {
                var tmp = ys;
                ys = ye;
                ye = tmp;
            }

			document.getElementById("led_column").innerHTML = (xs + " - " + xe);
			document.getElementById("led_row").innerHTML = (ys + " - " + ye);
			xml_request = "&SetArea=X" + xs + "-" + xe + "Y" + ys + "-" + ye;
			SendDataToArduino();
		}

		// on load
		window.onload = function() {
            SliderTwoThumb_Update();
		};
		
	</script>

    
	<style type="text/css">
		.out_box {
			float: left;
			margin: 0 20px 20px 0;
			border: 1px solid blue;
			padding: 0 5px 0 5px;
			min-width: 280px;
		}
		input {
			margin: 10px;
		}
		input {
			vertical-align: -3px;
		}
		h1 {
			font-size: 150%;
			color: black;
			margin: 0 0 10px 0;
			width: calc(100% - 32px);
			border-radius: 4px;
			padding: 8px 16px 8px 16px;
			border: 2px solid #000000;
		}
		h2 {
			font-size: 120%;
			color: #2f0fb3;
			margin: 5px 0 5px 0;
			width: calc(100% - 32px);
			border-radius: 4px;
			padding: 8px 16px 8px 16px;
			border: 2px solid #2f0fb3;
		}
		p, form, button {
			font-size: 80%;
			color: #252525;
		}
		.small_text {
			font-size: 70%;
			color: #737373;
		}
		/*----------------------------------------------------------------------*/
		/* button */
		.button {
			background-color: #4CAF50; /* Green */
			border: none;
			border-radius: 4px;
			color: white;
			padding: 16px 32px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			font-size: 16px;
			margin: 4px 2px;
			-webkit-transition-duration: 0.4s; /* Safari */
			transition-duration: 0.4s;
			cursor: pointer;
		}

		.button {
			background-color: white; 
			color: black; 
			border: 2px solid #4CAF50;
		}

		.button:hover {
			background-color: #4CAF50;
			color: black;
		}
		.button:active {
			background-color: #337536;
			color: white;
			transform: translateY(2px);
		}		
		.active-class {
			background-color: #337536;
			color: white;
		}
		
		/*----------------------------------------------------------------------*/
		/* slider */
		.slidecontainer {
			width: 100%;
		}
		
		.slider {
			-webkit-appearance: none;
            -moz-appearance: none;
			width: 100%;
			height: 15px;
			border-radius: 5px;  
			background: #d3d3d3;
			outline: none;
			opacity: 0.7;
			-webkit-transition: .2s;
			transition: opacity .2s;
		}

		.slider::-webkit-slider-thumb {
			-webkit-appearance: none;
            -moz-appearance: none;
			appearance: none;
			width: 25px;
			height: 25px;
			border-radius: 50%; 
			background: #4CAF50;
			cursor: pointer;
		}

		.slider::-moz-range-thumb {
			width: 25px;
			height: 25px;
			border-radius: 50%;
			background: #4CAF50;
			cursor: pointer;
		}
		
		
        /*---------------------------------------------------------------------*/
        /* 2 thumb slider */
        #led_slider_row {
            width: 100px;	
            height: 4em;
        }

        #led_slider_column {
            width: calc(100% - 100px);
        }

        .wrap {
            --dif: calc(var(--max) - var(--min));
            display: grid;
            grid-template: repeat(2, max-content) 2em/1fr 1fr;
            overflow: hidden;
            position: relative;
            margin: 1em auto;
            width: 100%;
            background: linear-gradient(0deg, #ccc 2em, transparent 0);
            font-family: ubuntu mono, consolas, monaco, monospace;
        }
        .wrap::before, .wrap::after {
            grid-column: 1/span 2;
            grid-row: 3;
            height: 100%;
            background: rgb(123, 202, 123);
            content: "";
        }
        .wrap::before {
            margin-left: calc((var(--a) - var(--min))/var(--dif)*100%);
            width: calc((var(--b) - var(--a))/var(--dif)*100%);
        }
        .wrap::after {
            margin-left: calc((var(--b) - var(--min))/var(--dif)*100%);
            width: calc((var(--a) - var(--b))/var(--dif)*100%);
        }

        [id=multi-lbl] {
            grid-column: 1/span 2;
        }

        .sr-only {
            position: absolute;
            clip-path: inset(50%);
        }

        input.twoThumbSlider[type=range] {
            grid-column: 1/span 2;
            grid-row: 3;
            z-index: 1;
            top: 0;
            left: 0;
            margin: 0;
            background: none;
            /* get rid of white Chrome background */
            color: #000;
            pointer-events: none;
        }
        input.twoThumbSlider[type=range]::-webkit-slider-runnable-track, input[type=range]::-webkit-slider-thumb, input[type=range] {
            -webkit-appearance: none;
        }
        input.twoThumbSlider[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 100%;
            background: none;
        }
        input.twoThumbSlider[type=range]::-moz-range-track {
            width: 100%;
            height: 100%;
            background: none;
        }
        input.twoThumbSlider[type=range]::-webkit-slider-thumb {
            border: none;
            /* get rid of Firefox thumb border */
            width: 2em;
            height: 100%;
            border-radius: 0;
            /* get rid of Firefox corner rounding */
            background: currentcolor;
            pointer-events: auto;
        }
        input.twoThumbSlider[type=range]::-moz-range-thumb {
            border: none;
            /* get rid of Firefox thumb border */
            width: 2em;
            height: 2em;
            border-radius: 0;
            /* get rid of Firefox corner rounding */
            background: currentcolor;
            pointer-events: auto;
        }
        input.twoThumbSlider[type=range]:focus {
            z-index: 2;
            outline: dotted 1px currentcolor;
        }
        input.twoThumbSlider[type=range]:focus, input[type=range]:focus + output {
            color: darkorange;
        }

        output.twoThumbSlider {
            grid-row: 2;
        }
        output.twoThumbSlider:last-child {
            text-align: right;
        }
        output.twoThumbSlider::after {
            counter-reset: c var(--c);
            content: "--" attr(for) ": " counter(c) ";";
        }

	</style>
</head>




<!--<body onload="GetArduinoIO()">-->
<body>
    <h1>MoBa Licht Steuerung</h1>
    <br>
    <button class="button" id="office_table_ww_button" onclick="LightSceneButtonPushed(LightScene.OFFICE_TABLE_WW, this)">B&uuml;rotisch</button>
    <button class="button" id="light_on_ww_button" onclick="LightSceneButtonPushed(LightScene.LIGHT_ON_WW, this)">Licht warm Weiss</button>
    <button class="button" id="disco_button" onclick="LightSceneButtonPushed(LightScene.DISCO, this)">Disco</button>
    <button class="button" id="sunset_button" onclick="LightSceneButtonPushed(LightScene.SUNSET, this)">Sunset</button>
    <button class="button" id="sunrise_button" onclick="LightSceneButtonPushed(LightScene.SUNRISE, this)">Sunrise</button>
    <button class="button" id="power_off" onclick="LightSceneButtonPushed(LightScene.POWER_OFF, this)">Power Off</button>
    <br>
    <br>
    <br>

    <h2>Helligkeit einstellen</h2>
    <br>
    <div class="slidecontainer">
        <label for="brightness_value">Helligkeit</label>
        <label id="brightness_value"></label>
        <input type="range" min="0" max="255" value="50" class="slider" id="brightness_slider" oninput="BrighntessSliderChanged()" style="background:rgb(255, 240, 27)">
    </div>
    <br>
    <br>
    
    <h2>Leuchtposition</h2>
    <table style="width: 100%">
        <tr>
            <td>
                <label for="led_row">Reihen</label>
                <label type="text" id="led_row" readonly style="border:0; color:#f6931f; font-weight:bold;"></label>      
            </td>
            <td>
                <label for="led_column">L&auml;nge</label>
                <label type="text" id="led_column" readonly style="border:0; color:#f6931f; font-weight:bold;"></label>
            </td>
        </tr>
        <tr>
            <td id="led_slider_row">
                <!--<div style="transform: rotate(270deg);">-->
                <div>
                    <div id="slider_row" class="wrap" role="group" aria-labelledby="multi-lbl" style="--a: 0; --b: 3; --min: 0; --max: 3;">
                    <!--<div id="multi-lbl">Multi thumb slider: 0 - 15</div>-->
                    <input id="a" class="twoThumbSlider" type="range" min="0" value="0" max="3" />
                    <!--<output for="a" style="--c: var(--a)"></output>-->
                    <input id="b" class="twoThumbSlider" type="range" min="0" value="3" max="3" />
                    <!--<output for="b" style="--c: var(--b)"></output>-->
                </div>
            </td>
            <td id=led_slider_column>
                <div id="slider_columen" class="wrap" role="group" aria-labelledby="multi-lbl" style="--a: 20; --b: 120; --min: 0; --max: 284">
                    <!--<div id="multi-lbl">Multi thumb slider: 0 - 15</div>-->
                    <input id="a" class="twoThumbSlider" type="range" min="0" value="20" max="284" />
                    <!--<output for="a" style="--c: var(--a)"></output>-->
                    <input id="b" class="twoThumbSlider" type="range" min="0" value="120" max="284" />
                    <!--<output for="b" style="--c: var(--b)"></output>-->
                </div>
            </td>
        </tr>
    </table>
</body>
</html>