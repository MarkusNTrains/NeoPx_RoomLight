<!-- html realtime: https://htmledit.squarefree.com/-->
<!DOCTYPE HTML>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MoBa Room Light</title>
	<link rel="icon" href="favicon.ico">

	<style type="text/css">
		:root {
            --backgroundColor: #222222;
            --headerBackgroundColor: #444444;
            --BackgroundColorActive: #ffbf00;
            --BackgroundColorHover: #ff8000;
            --sliderBackgroundColor: #4b4b4b;
            --ButtonBackgroundColor: #38a2a7;
		    --SliderThumbColor: var(--sliderBackgroundColor);
            --textColorDark: #000000;
            --textColorLight: #ffffff;
            --boarderColor: #000000;

            background-color: var(--backgroundColor);
            color: var(--textColorLight);

			font-family: Arial, Helvetica, sans-serif;
		}
		.out_box {
			float: left;
			margin: 0 20px 20px 0;
			border: 1px solid blue;
			padding: 0 5px 0 5px;
			min-width: 280px;
		}
		input {
			margin: 10px;
		}
		input {
			vertical-align: -3px;
		}
		h2 {
			font-size: 120%;
			color: var(--textColorLight);
            background-color: var(--headerBackgroundColor);
			margin: 5px 0 5px 0;
			width: calc(100% - 32px);
			border-radius: 4px;
			padding: 8px 16px 8px 16px;
			border: 2px solid var(--boarderColor);
		}
		p, form, button {
			font-size: 80%;
			color: var(--textColorDark);
            background-color: var(--backgroundColor);
		}
        a {
            color: var(--BackgroundColorActive);
        }

        /*----------------------------------------------------------------------*/
		/* box */
		.box {
			background-color: var(--backgroundColor);
			width: 100%;
			border-radius: 4px;
			/*border: 2px solid var(--boarderColor);			*/
		}		
		.box_header {
			font-size: 125%;
			font-weight: bold;
			color: var(--textColorLight);
            background-color: var(--headerBackgroundColor);
			margin: 0 0 10px 0;
			width: calc(100% - 32px);
			padding: 8px 16px 8px 16px;
		}
		.box_content {
			padding: 8px 8px 8px 8px;
		}
		
        /*----------------------------------------------------------------------*/
		/* button */
		.button {
            color: var(--textColorDark);
			background-color: var(--ButtonBackgroundColor);
			/*border: 2px solid var(--headerBackgroundColor);*/
			border-radius: 4px;
			padding: 16px 12px;
			text-align: center;
			/*text-decoration: none;*/
			display: inline-block;
			font-size: 16px;
			margin: 4px 2px;
			-webkit-transition-duration: 0.4s; /* Safari */
			transition-duration: 0.4s;
			cursor: pointer;
		}

		.button:hover {
			background-color: var(--BackgroundColorHover);
			color: var(--textColorDark);
		}
		.button:active {
			background-color: var(--BackgroundColorActive);
			color: var(--textColorDark);
			transform: translateY(2px);
		}		
		.active-class {
			background-color: var(--BackgroundColorActive);
			color: var(--textColorDark);
		}
		
        /*----------------------------------------------------------------------*/
        /* user values */
        .user_value {
            border: 0; 
            color: #f6931f; 
            font-weight: bold;
        }

		/*----------------------------------------------------------------------*/
		/* slider */
		.slidecontainer {
			width: 100%;
		}
		
		.slider {
			-webkit-appearance: none;
            -moz-appearance: none;
			width: calc(100% - 15px);
			height: 15px;
			border: 1px solid var(--headerBackgroundColor);
			border-radius: 5px;  
			background: var(--BackgroundColorActive);
			outline: none;
			opacity: 1;
			-webkit-transition: .2s;
			transition: opacity .2s;
		}

		.slider::-webkit-slider-thumb {
			-webkit-appearance: none;
            -moz-appearance: none;
			appearance: none;
			width: 25px;
			height: 25px;
			border-radius: 50%; 
			background: var(--SliderThumbColor);
			cursor: pointer;
		}

		.slider::-moz-range-thumb {
			width: 25px;
			height: 25px;
			border-radius: 50%;
			background: var(--SliderThumbColor);
			cursor: pointer;
		}
		
		
        /*---------------------------------------------------------------------*/
        /* 2 thumb slider */
        #led_slider_row {
            width: 150px;	
        }

        #led_slider_column {
            width: calc(100% - 150px);
        }

        .wrap {
            --dif: calc(var(--max) - var(--min));
            display: grid;
            grid-template: repeat(2, max-content) 2em/1fr 1fr;
            overflow: hidden;
            position: relative;
            margin: 1em auto;
            width: 100%;
            background: linear-gradient(0deg, var(--sliderBackgroundColor) 2em, transparent 0);
            font-family: ubuntu mono, consolas, monaco, monospace;
            /*border: 1px solid;*/
            border-color: var(--sliderBackgroundColor);
            border-radius: 10px;
        }
        .wrap::before, .wrap::after {
            grid-column: 1/span 2;
            grid-row: 3;
            height: 100%;
            background: var(--BackgroundColorActive);
            content: "";
        }
        .wrap::before {
            margin-left: calc((var(--a) - var(--min))/var(--dif)*100%);
            width: calc((var(--b) - var(--a))/var(--dif)*100%);
        }
        .wrap::after {
            margin-left: calc((var(--b) - var(--min))/var(--dif)*100%);
            width: calc((var(--a) - var(--b))/var(--dif)*100%);
        }

        [id=multi-lbl] {
            grid-column: 1/span 2;
        }

        .sr-only {
            position: absolute;
            clip-path: inset(50%);
        }

        input.twoThumbSlider[type=range] {
            grid-column: 1/span 2;
            grid-row: 3;
            z-index: 1;
            top: 0;
            left: 0;
            margin: 0;
            background: none;
            /* get rid of white Chrome background */
            color: var(--SliderThumbColor);
            pointer-events: none;
        }
        input.twoThumbSlider[type=range]::-webkit-slider-runnable-track, input[type=range]::-webkit-slider-thumb, input[type=range] {
            -webkit-appearance: none;
        }
        input.twoThumbSlider[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 100%;
            background: none;
        }
        input.twoThumbSlider[type=range]::-moz-range-track {
            width: 100%;
            height: 100%;
            background: none;
        }
        input.twoThumbSlider[type=range]::-webkit-slider-thumb {
            border: 1px solid var(--backgroundColor);
            /* get rid of Chrom thumb border */
            width: 2em;
            height: 100%;
            border-radius: 0;
            /* get rid of Chrome corner rounding */
            background: currentcolor;
            pointer-events: auto;
        }
        input.twoThumbSlider[type=range]::-moz-range-thumb {
            border: 1px solid var(--backgroundColor);
            /* get rid of Firefox thumb border */
            width: 2em;
            height: 100%;
            border-radius: 0;
            /* get rid of Firefox corner rounding */
            background: currentcolor;
            pointer-events: auto;
        }
        input.twoThumbSlider[type=range]:focus {
            z-index: 2;
            outline: dotted 1px currentcolor;
        }
        input.twoThumbSlider[type=range]:focus, input[type=range]:focus + output {
            color: darkorange;
        }

        output.twoThumbSlider {
            grid-row: 2;
        }
        output.twoThumbSlider:last-child {
            text-align: right;
        }
        output.twoThumbSlider::after {
            counter-reset: c var(--c);
            content: "--" attr(for) ": " counter(c) ";";
        }

	</style>


	<script type="text/javascript" charset="utf-8">
        //--- const ------------------------------------------------------
        //--- Firmware version
        const GLOBAL_WebserverVersion_Major = 1;
        const GLOBAL_WebserverVersion_Minor = 6;


		const LIGHT_SCENE = 
		{
			OfficeTable: 0,
			LightOn: 1,
			Rainbow: 2,
			Sunset: 3,
			Sunrise: 4,
			PowerOff: 5,
            Disco: 6,
            Sbh: 7,
            UserSetting: 8,
			IDLE: 9,
            Lightning: 10,
            Moba: 11,
            Day: 12,
            Night: 13,
            Cloud: 14,
            NOF: 15
		};

        const XML_RREQUEST = 
        {
            GetCurrentData: "GetCurrentData",
			GetInfo: "GetInfo",
            SetArea: "SetArea",
            SetBrightness: "SetBrightness",
            SetColor: "SetColor",
            SetLightScene: "LightScene",
        };

        const FIND_SERVER_TIMEOUT_MS = 2000;
        const REQUEST_CURRENT_DATA_FROM_SERVER_TIMEOUT_MS = 3000;
        const SERVER_RESPONSE_TIMEOUT_MS = 2500;  // must be shorter than REQUEST_CURRENT_DATA_FROM_ARDUINO_TIMEOUT_MS
        const USER_SETTING_OFFSET = 1;
        

		//--- static variables --------------------------------------------
		var s_lock_send_data = false;
		var s_is_send_data_pending = false;
        var s_pending_xml_request = "";
		var s_sendToServer_timeoutTimer = null;
        var s_requestDataFromServer_intervalTimer = null;
        var s_findServer_intervalTimer = null;
        var s_is_server_connected = true;
		var s_xhttp = null;


		//--- function prototypes -----------------------------------------


        //--- function ----------------------------------------------------
		function SendDataToServer(xml_request)
		{
			if (s_lock_send_data == false)
			{
				s_lock_send_data = true;
                Reset_RequestCurrentDataFromServer_IntervallTimer();
				nocache = "&nocache=" + Math.random() * 1000000;

                if (s_xhttp != null)
                {
                    s_xhttp.abort();
                    s_xhttp = null;
                }

				s_xhttp = new XMLHttpRequest();
                s_xhttp.timeout = SERVER_RESPONSE_TIMEOUT_MS;
                s_xhttp.ontimeout = function()
                {
                    s_is_server_connected = false;
                    clearInterval(s_requestDataFromServer_intervalTimer);

                    document.body.style.cursor = "progress";

                    LightScene_SetAllAsInactive();

                    document.getElementById("brightness_value").innerHTML = ("loading...");
                    document.getElementById("color_rgb_value").innerHTML = ("loading...");
                    document.getElementById("color_red_value").innerHTML = ("loading...");
                    document.getElementById("color_green_value").innerHTML = ("loading...");
                    document.getElementById("color_blue_value").innerHTML = ("loading...");
                    document.getElementById("color_white_value").innerHTML = ("loading...");
                    document.getElementById("led_column").innerHTML = ("loading...");
                    document.getElementById("led_row").innerHTML = ("loading...");
                    document.querySelector(':root').style.setProperty('--SliderThumbColor', '#3F3F3F');

                    document.getElementById("footer_version").innerHTML = ("v" + GLOBAL_WebserverVersion_Major + "." + GLOBAL_WebserverVersion_Minor);

                    FindServer();
                }
				s_xhttp.onreadystatechange = function()
				{
					if (this.readyState == XMLHttpRequest.DONE) 
					{
						if (this.status == 200) 
						{
							if (this.responseXML != null) 
							{
								// XML file received from Server
                                if (s_is_server_connected == false)
                                {
                                    s_is_server_connected = true;
                                    document.body.style.cursor = "default";
                                    clearInterval(s_findServer_intervalTimer);
                                    RequestCurrentDataFromServer();
                                }

								var re = this.responseXML.getElementsByTagName('info');
								if ((re != undefined) && (re != null) && (re.length > 0))
                                {
                                    var version_major = this.responseXML.getElementsByTagName('major')[0].childNodes[0].nodeValue;
                                    var version_minor = this.responseXML.getElementsByTagName('minor')[0].childNodes[0].nodeValue;
                                    var led_nof_row = parseInt(this.responseXML.getElementsByTagName('nof_row')[0].childNodes[0].nodeValue);
                                    var led_nof_px = parseInt(this.responseXML.getElementsByTagName('nof_leds')[0].childNodes[0].nodeValue);
                                    var xs = parseInt(this.responseXML.getElementsByTagName('xs')[0].childNodes[0].nodeValue);
                                    var xe = parseInt(this.responseXML.getElementsByTagName('xe')[0].childNodes[0].nodeValue);
                                    var ys = parseInt(this.responseXML.getElementsByTagName('ys')[0].childNodes[0].nodeValue);
                                    var ye = parseInt(this.responseXML.getElementsByTagName('ye')[0].childNodes[0].nodeValue);


                                    //--- update user setting columen and row slider --------------------------------
                                    //<!--<div style="transform: rotate(270deg);">-->
                                    //<div id="slider_row" class="wrap" role="group" aria-labelledby="multi-lbl" style="--a: 0; --b: 5; --min: 0; --max: 5;">
                                    //    <!--<div id="multi-lbl">Multi thumb slider: 0 - 15</div>-->
                                    //    <input id="a" class="twoThumbSlider" type="range" min="0" value="0" max="5" />
                                    //    <!--<output for="a" style="--c: var(--a)"></output>-->
                                    //    <input id="b" class="twoThumbSlider" type="range" min="0" value="5" max="5" />
                                    //    <!--<output for="b" style="--c: var(--b)"></output>-->
                                    //</div>
                                    var slider_row_max = led_nof_row - USER_SETTING_OFFSET;
                                    document.getElementById("led_slider_row").innerHTML = (
                                        '<div id="slider_row" class="wrap" role="group" aria-labelledby="multi-lbl" style="--a: ' + ys + '; --b: ' + ye + '; --min: 0; --max: ' + slider_row_max + ';">'
                                        +   '<input name="ledSliderRow_a" id="a" class="twoThumbSlider" type="range" min="0" value="' + ys + '" max="' + slider_row_max + '" />'
                                        +   '<input name="ledSliderRow_b" id="b" class="twoThumbSlider" type="range" min="0" value="' + ye + '" max="' + slider_row_max + '" />'
                                        + '</div>'
                                    );
                                    if (led_nof_row > 1)
                                    {
                                        document.getElementById("led_slider_row").style.visibility = 'visible';
                                    }
                                    else
                                    {
                                        document.getElementById("led_slider_row").style.visibility = 'hidden';
                                    }

                                    //<div id="slider_columen" class="wrap" role="group" aria-labelledby="multi-lbl" style="--a: 20; --b: 120; --min: 0; --max: 239">
                                    //    <!--<div id="multi-lbl">Multi thumb slider: 0 - 15</div>-->
                                    //    <input id="a" class="twoThumbSlider" type="range" min="0" value="20" max="239" />
                                    //    <!--<output for="a" style="--c: var(--a)"></output>-->
                                    //    <input id="b" class="twoThumbSlider" type="range" min="0" value="120" max="239" />
                                    //    <!--<output for="b" style="--c: var(--b)"></output>-->
                                    //</div>
                                    var slider_column_max = led_nof_px - USER_SETTING_OFFSET;
                                    document.getElementById("led_slider_column").innerHTML = (
                                        '<div id="slider_columen" class="wrap" role="group" aria-labelledby="multi-lbl" style="--a: ' + xs + '; --b: ' + xe + '; --min: 0; --max: ' + slider_column_max + '">'
                                        +   '<input name="ledSliderColumn_a" id="a" class="twoThumbSlider" type="range" min="0" value="' + xs + '" max="' + slider_column_max + '" />'
                                        +   '<input name="ledSliderColumn_b" id="b" class="twoThumbSlider" type="range" min="0" value="' + xe + '" max="' + slider_column_max + '" />'
                                        + '</div>'
                                    );

                                    //--- display Arduino room light firmware version in footer ---------------------
                                    document.getElementById("footer_version").innerHTML = ("v" + version_major + "." + version_minor);
                                    if ((version_major != GLOBAL_WebserverVersion_Major) || (version_minor != GLOBAL_WebserverVersion_Minor))
                                    {
                                        location.reload();
                                    }
                                }
								
								re = this.responseXML.getElementsByTagName('scene');
								if ((re != undefined) && (re != null) && (re.length > 0))
								{
                                    LightScene_ShowAsActive(re[0].childNodes[0].nodeValue);
                                }	

								re = this.responseXML.getElementsByTagName('brightness');
								if ((re != undefined) && (re != null) && (re.length > 0))
								{
									document.getElementById("brightness_slider").value = re[0].childNodes[0].nodeValue;
									document.getElementById("brightness_value").innerHTML = re[0].childNodes[0].nodeValue;
								}

								re = this.responseXML.getElementsByTagName('color');
								if ((re != undefined) && (re != null) && (re.length > 0))
								{
									var color = parseInt(re[0].childNodes[0].nodeValue);
                                    if (color > 0xFFFFFF)
                                    {
                                        var white = (color >> 24) & 0xFF;
                                        document.getElementById("color_white_slider").value = white;
                                        document.getElementById("color_white_value").innerHTML = white;
                                        colorStr = ('000000' + ((white << 16) | (white << 8) | white).toString(16)).slice(-6);
                            			document.querySelector(':root').style.setProperty('--SliderThumbColor', '#' + colorStr);
                                    }
                                    else
                                    {
                                        var slider_value = 0;
                                        if (((color >= 0xFF0000) && (color <= 0xFFFF00)) && (((color & 0xFF0000) == 0xFF0000) && (((color & 0xFF) == 0x0))))
                                        {
                                            slider_value = ((color & 0xFF00) >> 8);
                                        }
                                        else if (((color >= 0x00FF00) && (color <= 0xFFFF00)) && (((color & 0xFF00) == 0xFF00) && (((color & 0xFF) == 0x0))))
                                        {
                                            slider_value = 511 - ((color & 0xFF0000) >> 16);
                                        }
                                        else if (((color >= 0x00FF00) && (color <= 0x00FFFF)) && (((color & 0xFF00) == 0xFF00) && (((color & 0xFF0000) == 0x0))))
                                        {
                                            slider_value = 512 + (color & 0xFF);
                                        }
                                        else if (((color >= 0x0000FF) && (color <= 0x00FFFF)) && (((color & 0xFF) == 0xFF) && (((color & 0xFF0000) == 0x0))))
                                        {
                                            slider_value = 1023 - ((color & 0x00FF00) >> 8);
                                        }
                                        else if (((color >= 0x0000FF) && (color <= 0xFF00FF)) && (((color & 0xFF) == 0xFF) && (((color & 0xFF00) == 0x0))))
                                        {
                                            slider_value = 1024 + ((color & 0xFF0000) >> 16);
                                        }
                                        else if (((color >= 0xFF0000) && (color <= 0xFF00FF)) && (((color & 0xFF0000) == 0xFF0000) && (((color & 0xFF00) == 0x0))))
                                        {
                                            slider_value = 1535 - (color & 0xFF);
                                        }

                                        // set rgb combined slider
                                        var colorStr = ('000000' + color.toString(16)).slice(-6);
                                        document.getElementById("color_rgb_slider").value = slider_value;
                                        document.getElementById("color_rgb_value").innerHTML = '0x' + colorStr;
                                        document.querySelector(':root').style.setProperty('--SliderThumbColor', '#' + colorStr);
                                    }

                                    // set rgb single slider
                                    var red = (color >> 16) & 0xFF;
                                    var green = (color >> 8) & 0xFF;
                                    var blue = color & 0xFF;
                                    document.getElementById("color_red_value").innerHTML = red;
                                    document.getElementById("color_green_value").innerHTML = green;
                                    document.getElementById("color_blue_value").innerHTML = blue;
                                    document.getElementById("color_red_slider").value = red;
                                    document.getElementById("color_green_slider").value = green;
                                    document.getElementById("color_blue_slider").value = blue;
								}

								re = this.responseXML.getElementsByTagName('led_area');
								if ((re != undefined) && (re != null) && (re.length > 0))
                                {
                                    var xs = parseInt(this.responseXML.getElementsByTagName('xs')[0].childNodes[0].nodeValue);
                                    var xe = parseInt(this.responseXML.getElementsByTagName('xe')[0].childNodes[0].nodeValue);
                                    var ys = parseInt(this.responseXML.getElementsByTagName('ys')[0].childNodes[0].nodeValue);
                                    var ye = parseInt(this.responseXML.getElementsByTagName('ye')[0].childNodes[0].nodeValue);

                                    document.getElementById("led_row").innerHTML = ((ys + USER_SETTING_OFFSET) + " - " + (ye + USER_SETTING_OFFSET));
                                    document.getElementById("slider_row").style.setProperty("--a", ys);
                                    document.getElementById("slider_row").style.setProperty("--b", ye);
                                    document.getElementsByName("ledSliderRow_a")[0].value = ys;
                                    document.getElementsByName("ledSliderRow_b")[0].value = ye;

                                    document.getElementById("led_column").innerHTML = ((xs + USER_SETTING_OFFSET) + " - " + (xe + USER_SETTING_OFFSET));
                                    document.getElementById("slider_columen").style.setProperty("--a", xs);
                                    document.getElementById("slider_columen").style.setProperty("--b", xe);
                                    document.getElementsByName("ledSliderColumn_a")[0].value = xs;
                                    document.getElementsByName("ledSliderColumn_b")[0].value = xe;
                                }


								if (s_sendToServer_timeoutTimer != null)
								{
									clearTimeout(s_sendToServer_timeoutTimer);
									ReleaseLock();
								}
							}
							else
							{
								alert("XML = NULL");
							}
						}
						else
						{
							//alert("Keine Verbindung zum Webserver\nStatus: " + this.status);
						}
					}
				}

				// send HTTP GET request with data
				s_xhttp.open("GET", "ajax_inputs" + xml_request + nocache, true);
				s_xhttp.send();
				
				// lock Send to Arduino
				s_sendToServer_timeoutTimer = setTimeout('ReleaseLock()', REQUEST_CURRENT_DATA_FROM_SERVER_TIMEOUT_MS);
			}
			else
			{
				s_is_send_data_pending = true;
                s_pending_xml_request = xml_request;
			}
		}
		
        function SendDataToServerWhenConnected(xml_request)
        {
            if (s_is_server_connected == true)
            {
                SendDataToServer(xml_request);
            }
        }

        function RequestCurrentDataFromServer()
        {
            SendDataToServerWhenConnected("&" + XML_RREQUEST.GetCurrentData);
        }
		
        function FindServer()
        {
            s_is_server_connected = false;
            clearInterval(s_findServer_intervalTimer);
            s_findServer_intervalTimer = setInterval(RequestFindServer, FIND_SERVER_TIMEOUT_MS)
        }

		function RequestFindServer()
		{
            SendDataToServer("&" + XML_RREQUEST.GetInfo);
		}

        function Reset_RequestCurrentDataFromServer_IntervallTimer()
        {
            clearInterval(s_requestDataFromServer_intervalTimer);
            s_requestDataFromServer_intervalTimer = setInterval(RequestCurrentDataFromServer, REQUEST_CURRENT_DATA_FROM_SERVER_TIMEOUT_MS);
        }
        
		function ReleaseLock()
		{
			s_lock_send_data = false;
			s_sendToServer_timeoutTimer = null;

			if (s_is_send_data_pending == true)
			{
				SendDataToServer(s_pending_xml_request);
                s_is_send_data_pending = false;
                s_pending_xml_request = "";
			}
		}
		
		function LightSceneButtonPushed(scene, bt)
		{
			LightScene_ShowAsActive(scene)
			SendDataToServerWhenConnected("&" + XML_RREQUEST.SetLightScene + "=" + scene);
		}

        function LightScene_SetAllAsInactive()
        {
			var matches = document.getElementsByClassName('active-class');
			for (var cnt = 0; cnt < matches.length; cnt++) 
			{
				matches[cnt].classList.remove('active-class');
			}
        }
		
        function LightScene_ShowAsActive(scene)
        {
            LightScene_SetAllAsInactive();
            
            if (scene < LIGHT_SCENE.NOF)
            {
			    document.getElementById("LightScene" + scene).classList.add("active-class");
            }
        }

		function BrighntessSliderChanged()
		{
			var slider = document.getElementById("brightness_slider");
			var output = document.getElementById("brightness_value");
			output.innerHTML = slider.value;

			SendDataToServerWhenConnected("&" + XML_RREQUEST.SetBrightness + "=" + slider.value);
		}

		function ColorRGBSliderChanged()
		{
			var slider = document.getElementById("color_rgb_slider");
			var output = document.getElementById("color_rgb_value");

			var color = 0;
			if (slider.value > 1279)
			{
				color = 0xFF00FF - (slider.value - 1280);
			}
			else if (slider.value > 1023)
			{
				color = 0x0000FF + ((slider.value - 1024) << 16);
			}
			else if (slider.value > 767)
			{
				color = 0x00FFFF - ((slider.value - 768) << 8);
			}
			else if (slider.value > 511)
			{
				color = 0x00FF00 + (slider.value - 512);
			}
			else if (slider.value > 255)
			{
				color = 0xFFFF00 - ((slider.value - 256) << 16);
			}
			else
			{
				color = 0xFF0000 + (slider.value << 8);
			}

			var colorStr = ('000000' + color.toString(16)).slice(-6);
			output.innerHTML = '0x' + colorStr;
			document.querySelector(':root').style.setProperty('--SliderThumbColor', '#' + colorStr);
			SendDataToServerWhenConnected("&" + XML_RREQUEST.SetColor + "=" + color);
            
            
            var red = (color >> 16) & 0xFF;
            var green = (color >> 8) & 0xFF;
            var blue = color & 0xFF;
			document.getElementById("color_red_value").innerHTML = red;
			document.getElementById("color_green_value").innerHTML = green;
			document.getElementById("color_blue_value").innerHTML = blue;
            document.getElementById("color_red_slider").value = red;
            document.getElementById("color_green_slider").value = green;
            document.getElementById("color_blue_slider").value = blue;
		}

        function ColorRGBSingleSliderChanged()
        {
			var red_slider = document.getElementById("color_red_slider");
			var green_slider = document.getElementById("color_green_slider");
			var blue_slider = document.getElementById("color_blue_slider");

			document.getElementById("color_red_value").innerHTML = red_slider.value;
			document.getElementById("color_green_value").innerHTML = green_slider.value;
			document.getElementById("color_blue_value").innerHTML = blue_slider.value;

            var color = 0;
            color = (red_slider.value << 16);
            color |= (green_slider.value << 8);
            color |= blue_slider.value

			var colorStr = ('000000' + color.toString(16)).slice(-6);
			document.querySelector(':root').style.setProperty('--SliderThumbColor', '#' + colorStr);
			document.getElementById("color_rgb_value").innerHTML = colorStr;
			SendDataToServerWhenConnected("&" + XML_RREQUEST.SetColor + "=" + color);			
        }

		function ColorWhiteSliderChanged()
		{
			var slider = document.getElementById("color_white_slider");
			var output = document.getElementById("color_white_value");
			
			var color = slider.value;
			output.innerHTML = color;
			colorStr = ('000000' + ((color << 16) | (color << 8) | color).toString(16)).slice(-6);
			document.querySelector(':root').style.setProperty('--SliderThumbColor', '#' + colorStr);
			SendDataToServerWhenConnected("&" + XML_RREQUEST.SetColor + "=" + (slider.value << 24));			
		}

		// 2 thumb slider
		"use strict";
		addEventListener('input', e => {
            if (e.target.classList.contains("twoThumbSlider"))
            {
                let _t = e.target;

                _t.parentNode.style.setProperty(`--${_t.id}`, +_t.value);
                
                SliderTwoThumb_Update();
            }
		}, false);

		function SliderTwoThumb_Update()
		{
            var xs = parseInt(getComputedStyle(document.getElementById("slider_columen")).getPropertyValue('--a'), 10);
            var xe = parseInt(getComputedStyle(document.getElementById("slider_columen")).getPropertyValue('--b'), 10);
            var ys = parseInt(getComputedStyle(document.getElementById("slider_row")).getPropertyValue('--a'), 10);
            var ye = parseInt(getComputedStyle(document.getElementById("slider_row")).getPropertyValue('--b'), 10);

            if (xs > xe)
            {
                var tmp = xs;
                xs = xe;
                xe = tmp;
            }
            if (ys > ye)
            {
                var tmp = ys;
                ys = ye;
                ye = tmp;
            }

			SendDataToServerWhenConnected("&" + XML_RREQUEST.SetArea + "=X" + xs + "-" + xe + "Y" + ys + "-" + ye);
            xs += USER_SETTING_OFFSET;
            xe += USER_SETTING_OFFSET;
            ys += USER_SETTING_OFFSET;
            ye += USER_SETTING_OFFSET;
			document.getElementById("led_column").innerHTML = (xs + " - " + xe);
			document.getElementById("led_row").innerHTML = (ys + " - " + ye);
		}


        //--- onload event handler ----------------------------------------
        window.addEventListener('load', (event) => 
        {
            var button = '<div class="button" id="LightScene' + LIGHT_SCENE.PowerOff + '" onclick="LightSceneButtonPushed(LIGHT_SCENE.PowerOff, this)">Off</div>'
             + '<div class="button" id="LightScene' + LIGHT_SCENE.OfficeTable + '" onclick="LightSceneButtonPushed(LIGHT_SCENE.OfficeTable, this)">B&uuml;rotisch</div>'
             + '<div class="button" id="LightScene' + LIGHT_SCENE.Moba + '" onclick="LightSceneButtonPushed(LIGHT_SCENE.Moba, this)">MoBa</div>'
             + '<div class="button" id="LightScene' + LIGHT_SCENE.LightOn + '" onclick="LightSceneButtonPushed(LIGHT_SCENE.LightOn, this)">All On</div>'
             + '<div class="button" id="LightScene' + LIGHT_SCENE.Rainbow + '" onclick="LightSceneButtonPushed(LIGHT_SCENE.Rainbow, this)">Rainbow</div>'
             + '<div class="button" id="LightScene' + LIGHT_SCENE.Disco + '" onclick="LightSceneButtonPushed(LIGHT_SCENE.Disco, this)">Disco</div>'
             + '<div class="button" id="LightScene' + LIGHT_SCENE.UserSetting + '" onclick="LightSceneButtonPushed(LIGHT_SCENE.UserSetting, this)">User Set</div>'
             + '<br>'
             + '<div class="button" id="LightScene' + LIGHT_SCENE.Sunrise + '" onclick="LightSceneButtonPushed(LIGHT_SCENE.Sunrise, this)">Sunrise</div>'
             + '<div class="button" id="LightScene' + LIGHT_SCENE.Day + '" onclick="LightSceneButtonPushed(LIGHT_SCENE.Day, this)">Day</div>'
             + '<div class="button" id="LightScene' + LIGHT_SCENE.Sunset + '" onclick="LightSceneButtonPushed(LIGHT_SCENE.Sunset, this)">Sunset</div>'
             + '<div class="button" id="LightScene' + LIGHT_SCENE.Night + '" onclick="LightSceneButtonPushed(LIGHT_SCENE.Night, this)">Night</div>'
             + '<div class="button" id="LightScene' + LIGHT_SCENE.Cloud + '" onclick="LightSceneButtonPushed(LIGHT_SCENE.Cloud, this)">Clouds</div>'
             + '<div class="button" id="LightScene' + LIGHT_SCENE.Lightning + '" onclick="LightSceneButtonPushed(LIGHT_SCENE.Lightning, this)">Lightning</div>';

            document.getElementById("LightScene").innerHTML = button;
            document.getElementById("footer_version").innerHTML = ("v" + GLOBAL_WebserverVersion_Major + "." + GLOBAL_WebserverVersion_Minor);

			FindServer();
        });

    </script>    
</head>

<body>
	<div class="box">
		<div class="box_header">Licht Szene</div>
		<div id="LightScene" class="box_content"></div>
	</div>
    <br>

    <div class="box">
        <div class="box_header">Helligkeit / Farbe</div>
        <div class="box_content">
            <div class="slidecontainer">
                <label for="brightness_value">Helligkeit</label>
                <label id="brightness_value" class="user_value"></label>
                <input type="range" min="0" max="255" value="50" class="slider" id="brightness_slider" oninput="BrighntessSliderChanged()">
            </div>
            <br>
            
            <div class="slidecontainer">
                <label for="color_rgb_value">RGB</label>
                <label id="color_rgb_value" class="user_value"></label>
                <input type="range" min="0" max="1535" value="50" class="slider" id="color_rgb_slider" oninput="ColorRGBSliderChanged()" style="background-image: linear-gradient(90deg, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000);">
            </div>
            <div class="slidecontainer">
                <label for="color_red_value">Rot</label>
                <label id="color_red_value" class="user_value"></label>
                <input type="range" min="0" max="255" value="50" class="slider" id="color_red_slider" oninput="ColorRGBSingleSliderChanged()" style="background-image: linear-gradient(90deg, black, red)">
            </div>
            <div class="slidecontainer">
                <label for="color_green_value">Gr&uuml;n</label>
                <label id="color_green_value" class="user_value"></label>
                <input type="range" min="0" max="255" value="50" class="slider" id="color_green_slider" oninput="ColorRGBSingleSliderChanged()" style="background-image: linear-gradient(90deg, black, rgb(0, 255, 0))">
            </div>
            <div class="slidecontainer">
                <label for="color_blue_value">Blau</label>
                <label id="color_blue_value" class="user_value"></label>
                <input type="range" min="0" max="255" value="50" class="slider" id="color_blue_slider" oninput="ColorRGBSingleSliderChanged()" style="background-image: linear-gradient(90deg, black, blue)">
            </div>
            <div class="slidecontainer">
                <label for="color_white_value">Weiss</label>
                <label id="color_white_value" class="user_value"></label>
                <input type="range" min="0" max="255" value="50" class="slider" id="color_white_slider" oninput="ColorWhiteSliderChanged()" style="background-image: linear-gradient(90deg, black, white)">
            </div>
        </div>
    </div>
    <br>
    
    <div class="box">
        <div class="box_header">User Set: Beleuchtungsbereich</div>
        <div class="box_content">
            <table style="width: 100%;">
                <tr>
                    <td>
                        <label for="led_row">Reihen</label>
                        <label type="text" id="led_row" class="user_value"> loading...</label>      
                    </td>
                    <td>
                        <label for="led_column">L&auml;nge</label>
                        <label type="text" id="led_column" class="user_value"> loading...</label>
                    </td>
                </tr>
                <tr>
                    <td id="led_slider_row">
                    </td>
                    <td id=led_slider_column>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</body>
</html>